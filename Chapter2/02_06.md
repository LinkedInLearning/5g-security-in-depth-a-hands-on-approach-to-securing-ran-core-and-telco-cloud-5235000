Lab: Analyzing 5G Authentication Call Flows for Threat Detection & TTP Mapping

 Learning Goal

"Investigate authentication call flows through live attack simulations and packet analysis to understand TTPs and improve incident response."

Objectives

By completing this lab, learners will:

Understand how security contexts are exchanged in 5G registration and session flows.

Identify and extract key security-relevant parameters from NAS and NGAP layers.

Learn how attackers may exploit these flows and how security teams can detect such attempts.

Map observed behaviors to MITRE FIGHT / ATT&CK TTPs

Threat Detection from Security Parameters

Parameter

Risk Example

TTP Mapping

SUPI/SUCI reuse

Replay of UE identity

Credential Access ‚Üí Identity Impersonation

AUTN/RES* mismatch

Faked auth response

Defense Evasion ‚Üí Protocol Manipulation

Duplicate UE NGAP ID

Zombie session replay

Persistence ‚Üí Session Fixation

Reused PDU Session ID

Hijacked tunnel reuse

Initial Access ‚Üí Tunneling Protocol Abuse

Unusual QoS/DNN

Suspicious data exfiltration

Exfiltration ‚Üí Over Command & Control

Hands-On Activities

Capture Packet Flows:

Use tcpdump on AMF and Wireshark to analyze ngap || nas-5gs

Capture flows from Registration, Auth, Context Setup, and PDU Session

Extract Parameters:

Annotate NAS/NGAP messages with fields: SUPI, UE NGAP ID, PDU Session ID, NASSecurityParameters, etc.

Replay Attack Simulation:

Use scapy or tcpreplay to resend Registration or PDU Session messages

Observe AMF behavior and logs for replay or desync handling

Analyze Logs:

Correlate Open5GS AMF logs with trace

Identify anomalies or repeated identifiers

TTP Mapping Report:

Link each security parameter and behavior to a TTP (e.g., MITRE FIGHT technique ID)

üìÇ Deliverables

Annotated .pcap trace file

TTP Mapping worksheet: Observed Behavior ‚Üí Parameter ‚Üí Risk ‚Üí TTP ‚Üí Mitigation

(Optional) SIEM-style detection rule or alert logic

üîπ Tools Used

Wireshark (with 5G dissectors)

tcpdump (for capture inside AMF pod)

Scapy (for message replay)

Open5GS (deployed via Kubernetes)

MITRE FIGHT or MITRE ATT&CK Framework

üåê Suggested Extensions

Create a Red vs. Blue exercise with attackers replaying and defenders detecting

Add Grafana/Prometheus dashboards for real-time NGAP/NAS parameter anomalies

Integrate this lab into a 5G security bootcamp module


